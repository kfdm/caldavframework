{% extends 'base.html' %}
{% load todo %}
{% block content %}

{% regroup task_list by due as grouped_tasks %}

<div class="row">
    <div class="col-sm-3">
        <ul>
            {% for project in project_list %}
            <li>
                <td><a href="{{project.get_absolute_url}}">{{project.title}}</a></td>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-sm-9">
{% for tl in grouped_tasks %}
        <h2>{{tl.grouper}}</h2>
        <table>
            <tr>
                <th>&nbsp;</th>
                <th>&nbsp;</th>
                <th>Title</th>
                <th>&nbsp;</th>
                <th>Start</th>
                <th>Due</th>
                <th>&nbsp;</th>
            </tr>
        {% for task in tl.list %}
            <tr {% if task.due < today %}class="text-danger"{% endif %}>
                <form method="POST" action="{% url 'task' pk=task.pk %}">{% csrf_token %}
                <td>
                    <div class="input-group-prepend">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{task|icon}}</button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" name="status" value="1">Open</button>
                            <button class="dropdown-item" name="status" value="2">Complete</button>
                            <button class="dropdown-item" name="status" value="3">Cancel</button>
                        </div>
                    </div>
                </td>
                <td>{{task|priority}}</td>
                <td>{{task.title}}
                    <br>
                    {% if task.project %}
                    <a class="badge badge-primary" href="{{task.project.get_absolute_url}}">{{task.project.title}}</a>
                    {% endif %}
                    {% for tag in task.tag_set.all %}
                    <span class="badge badge-secondary">{{tag.title}}</span>
                    {% endfor %}
                </td>
                <td>
                    <div class="input-group-prepend">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {% if task.start %}{{task.start}}{% endif %}
                        </button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" name="start" value="yeseterday">Yesterday</button>
                            <button class="dropdown-item" name="start" value="today">Today</button>
                            <button class="dropdown-item" name="start" value="tomorrow">Tomorrow</button>
                            <button class="dropdown-item" name="start" value="reset">Reset</button>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="input-group-prepend">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {% if task.due %}{{task.due}}{% endif %}
                        </button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" name="due" value="yeseterday">Yesterday</button>
                            <button class="dropdown-item" name="due" value="today">Today</button>
                            <button class="dropdown-item" name="due" value="tomorrow">Tomorrow</button>
                            <button class="dropdown-item" name="due" value="reset">Reset</button>
                        </div>
                    </div>
                </td>
                <td>
                    {% if task.external %}
                        <a href="{{task.external.url}}">E</a>
                    {% endif %}
                </td>
                <td><a href="{{task.get_absolute_url}}">?</a></td>
                </form>
            </tr>
        {% endfor %}
        </table>
{% endfor %}
    </div>
</div>
{% endblock %}